{"version":3,"file":"semantic-validate.esm.mjs","sources":["../src/Core/Core.ts","../src/SemanticValidate/SemanticValidate.ts"],"sourcesContent":["import DOMPurify from 'dompurify';\r\nimport { Form, Lang, Options, Rule, Schema } from '../types/types.js';\r\n\r\nexport default class Core {\r\n    form: Form;\r\n    lang: Lang;\r\n    options: Options;\r\n    rules: Map<string, Rule>;\r\n\r\n    /**\r\n     * \r\n     * @param form \r\n     * @param options \r\n     */\r\n    constructor(form: string, options: Options = {}) {\r\n        this.form = new WeakRef(document.querySelector(form));\r\n        this.options = options;\r\n        this.rules = new Map();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    validate() {}\r\n\r\n    /**\r\n     * \r\n     * @param lang \r\n     * @returns \r\n     */\r\n    setLang(lang: string) {\r\n        this.lang = lang;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param rules \r\n     * @returns \r\n     */\r\n    setRules(rules: Rule[]) {\r\n        for(const rule of rules) {\r\n            if (!this.rules.has(rule.name)) {\r\n                this.throwError(new Error(`The ${rule.name} rule already exists!`));\r\n            }\r\n\r\n            this.rules.set(rule.name, rule);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param schema \r\n     * @returns \r\n     */\r\n    setSchema(schema: Schema) {\r\n        const strategy = {\r\n            lang: (value) => this.lang = value,\r\n            rules: (value) => this.setRules(value),\r\n        };\r\n\r\n        for (const [key, value] of Object.entries(schema)) {\r\n            strategy[key](value);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    disableNativeValidation(flag = true) {\r\n        this.form.deref().setAttribute('novalidate', String(flag));\r\n    }\r\n\r\n    setElementRules(element, rules) {\r\n        for(const [attr, value] of Object.entries(rules)) {\r\n            if (attr === 'name') continue;\r\n            element.setAttribute(attr, value);\r\n        }\r\n    }\r\n\r\n    bindElementsWithRules() {\r\n        const onInput = (event) => {\r\n            // console.log(event.target.validity);\r\n        };\r\n\r\n        for(const element of this.form.deref().elements) {\r\n            const name = element.getAttribute('name');\r\n            \r\n            if (!name) continue;\r\n\r\n            const rules = this.rules.get(name);\r\n\r\n            if (!rules) continue;\r\n            \r\n            this.setElementRules(element, rules);\r\n\r\n            element.removeEventListener('input', onInput);  \r\n            element.addEventListener('input', onInput);\r\n        }\r\n    }\r\n\r\n    sanitize(value: FormDataEntryValue) {\r\n        return DOMPurify.sanitize(value as string);\r\n    }\r\n\r\n    getData() {\r\n\r\n        const handleSelectMultiple = ([name, value]) => {\r\n            const rules = this.rules.get(name);\r\n\r\n            if (rules.type === 'select' && rules.multiple) {\r\n                const select = this.form.deref().elements[name] as HTMLSelectElement;\r\n\r\n                const selectedValues = [...select.selectedOptions]\r\n                    .filter(option => option.selected)\r\n                    .map(option => option.value)\r\n\r\n                return [name, selectedValues];\r\n            }\r\n\r\n            return [name, value];\r\n        }\r\n\r\n        const formData = Array\r\n            .from(new FormData(this.form.deref()).entries())\r\n            .map(handleSelectMultiple)\r\n            .map(([name, value]) => {\r\n                return [\r\n                    name,\r\n                    this.options.sanitize ? this.sanitize(value) : value,\r\n                ];                \r\n            });\r\n\r\n        return Object.fromEntries(formData);\r\n    }\r\n\r\n    getDataSerialized() {\r\n        const formDataSerialized = new URLSearchParams();\r\n\r\n        Array\r\n            .from(Object.entries(this.getData()))\r\n            .forEach(([name, value]) => formDataSerialized.set(name, String(value)));\r\n\r\n        console.log(new URLSearchParams(formDataSerialized.toString()).get('select2'));\r\n        \r\n\r\n        \r\n        return formDataSerialized.toString();\r\n    }\r\n\r\n    throwError(error: Error) {\r\n\r\n    }\r\n}","import { Core } from \"../Core\";\r\nimport { Lang, Options, Rule, Schema } from \"../types/types\";\r\n\r\nexport default class SemanticValidate extends Core {\r\n    /**\r\n     * \r\n     * @param form \r\n     * @param options \r\n     */\r\n    constructor(form: string, options?: Options) {\r\n        super(form, options);\r\n    }\r\n\r\n    /**\r\n     * Add a lang to setup right messages\r\n     * @param lang \r\n     * @returns SemanticValidate instance\r\n     */\r\n    addLang(lang: Lang): SemanticValidate {\r\n        return super.setLang(lang);\r\n    }\r\n\r\n    /**\r\n     * Add rules for de fields\r\n     * @param rules \r\n     * @returns SemanticValidate instance\r\n     */\r\n    addRules(rules: Rule[]) {\r\n        return super.setRules(rules);\r\n    }\r\n\r\n    /**\r\n     * Add a schema\r\n     * @param schema \r\n     * @returns SemanticValidate instance\r\n     */\r\n    addSchema(schema: Schema): SemanticValidate {\r\n        return this.setSchema(schema);\r\n    }\r\n\r\n    /**\r\n     * Render form based on rules\r\n     * @returns SemanticValidate instance\r\n     */\r\n    render(): SemanticValidate {\r\n        super.disableNativeValidation();\r\n        super.bindElementsWithRules();\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Trigger the fn callback when form is sumitted\r\n     * @param fn \r\n     */\r\n    whenSubmit(fn) {\r\n        const handler = (event: Event) => {\r\n            event.preventDefault();\r\n\r\n            fn(event, {\r\n                valid: this.form.deref().checkValidity(),\r\n                values: super.getData(),\r\n                ...(this.options.serialized && { \r\n                    serialized: super.getDataSerialized() \r\n                }),\r\n            });\r\n        };\r\n\r\n        this.form.deref().removeEventListener('submit', handler);\r\n        this.form.deref().addEventListener('submit', handler);\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}